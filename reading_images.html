<!doctype html>
<html lang="en">
<head>
<title>Reading image data in python</title>
<!-- 2022-11-11 Fri 06:23 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Org-mode">
<meta name="author" content="Daniele Arosio - This post was written entirely in org-mode and ob-ipython. You can download this notebook.">

<link  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<style>
/* org mode styles on top of twbs */

html {
    position: relative;
    min-height: 100%;
}

body {
    font-size: 18px;
    margin-bottom: 105px;
}

footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 101px;
    background-color: #f5f5f5;
}

footer > div {
    padding: 10px;
}

footer p {
    margin: 0 0 5px;
    text-align: center;
    font-size: 16px;
}

#table-of-contents {
    margin-top: 20px;
    margin-bottom: 20px;
}

blockquote p {
    font-size: 18px;
}

pre {
    font-size: 16px;
}

.footpara {
    display: inline-block;
}

figcaption {
  font-size: 16px;
  color: #666;
  font-style: italic;
  padding-bottom: 15px;
}

/* from twbs docs */

.bs-docs-sidebar.affix {
    position: static;
}
@media (min-width: 768px) {
    .bs-docs-sidebar {
        padding-left: 20px;
    }
}

/* All levels of nav */
.bs-docs-sidebar .nav > li > a {
    display: block;
    padding: 4px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #999;
}
.bs-docs-sidebar .nav > li > a:hover,
.bs-docs-sidebar .nav > li > a:focus {
    padding-left: 19px;
    color: #A1283B;
    text-decoration: none;
    background-color: transparent;
    border-left: 1px solid #A1283B;
}
.bs-docs-sidebar .nav > .active > a,
.bs-docs-sidebar .nav > .active:hover > a,
.bs-docs-sidebar .nav > .active:focus > a {
    padding-left: 18px;
    font-weight: bold;
    color: #A1283B;
    background-color: transparent;
    border-left: 2px solid #A1283B;
}

/* Nav: second level (shown on .active) */
.bs-docs-sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 30px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav > li > a:focus {
    padding-left: 29px;
}
.bs-docs-sidebar .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav > .active:focus > a {
    padding-left: 28px;
    font-weight: 500;
}

/* Nav: third level (shown on .active) */
.bs-docs-sidebar .nav .nav .nav {
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 40px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav .nav > li > a:focus {
    padding-left: 39px;
}
.bs-docs-sidebar .nav .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav .nav > .active:focus > a {
    padding-left: 38px;
    font-weight: 500;
}

/* Show and affix the side nav when space allows it */
@media (min-width: 992px) {
    .bs-docs-sidebar .nav > .active > ul {
        display: block;
    }
    /* Widen the fixed sidebar */
    .bs-docs-sidebar.affix,
    .bs-docs-sidebar.affix-bottom {
        width: 213px;
    }
    .bs-docs-sidebar.affix {
        position: fixed; /* Undo the static from mobile first approach */
        top: 20px;
    }
    .bs-docs-sidebar.affix-bottom {
        position: absolute; /* Undo the static from mobile first approach */
    }
    .bs-docs-sidebar.affix .bs-docs-sidenav,.bs-docs-sidebar.affix-bottom .bs-docs-sidenav {
        margin-top: 0;
        margin-bottom: 0
    }
}
@media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .bs-docs-sidebar.affix-bottom,
    .bs-docs-sidebar.affix {
        width: 263px;
    }
}
</style>
<script>
$(function() {
    'use strict';

    $('.bs-docs-sidebar li').first().addClass('active');

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $('.bs-docs-sidebar').affix();
});
</script>
</head>
<body>
<div id="content" class="container">
<div class="row"><div class="col-md-3 col-md-push-9"><nav id="table-of-contents">
<div id="text-table-of-contents" class="bs-docs-sidebar">
<ul class="nav">
<li><a href="#sec-1">1. Limitation of scipy.ndimage and matplotlib.image</a>
<ul class="nav">
<li><a href="#sec-1-1">1.1. imageio.imread reads 3D properly</a></li>
<li><a href="#sec-1-2">1.2. matplotlib</a></li>
</ul>
</li>
<li><a href="#sec-2">2. scikit-image</a></li>
<li><a href="#sec-3">3. Other two options</a>
<ul class="nav">
<li><a href="#sec-3-1">3.1. tifffile</a></li>
<li><a href="#sec-3-2">3.2. bioformat</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Conclusions</a></li>
</ul>
</div>
</nav>
</div><div class="col-md-9 col-md-pull-3"><h1 class="title">Reading image data in python</h1>
<div class="org-src-container">

<pre class="src src-jupyter-python"><span style="color: #ffad29; font-weight: bold;">import</span> numpy
<span style="color: #ffad29; font-weight: bold;">from</span> scipy <span style="color: #ffad29; font-weight: bold;">import</span> ndimage
<span style="color: #ffad29; font-weight: bold;">import</span> matplotlib.pyplot <span style="color: #ffad29; font-weight: bold;">as</span> plt
<span style="color: #ffad29; font-weight: bold;">import</span> matplotlib.image
<span style="color: #ffad29; font-weight: bold;">import</span> matplotlib
</pre>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Limitation of scipy.ndimage and matplotlib.image</h2>
<div class="outline-text-2" id="text-1">
<p>
Using imread() from either scipy.ndimage or maptplotlib.image results in
importing only the first image of a tif (multichannel) time sequence.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> imageio.imread reads 3D properly</h3>
<div class="outline-text-3" id="text-1-1">
<p>
As ndimage.imread does not exist anymore.
</p>

<div class="org-src-container">

<pre class="src src-jupyter-python"><span style="color: #ffad29; font-weight: bold;">import</span> imageio
<span style="color: #dbdb95;">im</span> = imageio.v2.imread(<span style="color: #e67128;">"/home/dati/liaisan/data/160304/HEK293_ClopHensor-pBJ1_MatraS_attempt/10x_200_200_200/c1.tif"</span>)
<span style="color: #23d7d7;">print</span>(<span style="color: #e67128;">"ndim = "</span>, im.ndim, <span style="color: #e67128;">"\nshape = "</span>, im.shape, <span style="color: #e67128;">'\nmax = '</span>, im.<span style="color: #23d7d7;">max</span>())
plt.imshow(im[0])
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> matplotlib</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-jupyter-python"><span style="color: #dbdb95;">im</span> = matplotlib.image.imread(<span style="color: #e67128;">"/home/dati/liaisan/data/160304/HEK293_ClopHensor-pBJ1_MatraS_attempt/10x_200_200_200/c1.tif"</span>)
<span style="color: #23d7d7;">print</span>(<span style="color: #e67128;">"ndim = "</span>, im.ndim, <span style="color: #e67128;">"\nshape = "</span>, im.shape, <span style="color: #e67128;">'\nmax = '</span>, im.<span style="color: #23d7d7;">max</span>())
plt.imshow(im)
</pre>
</div>

<pre class="example">
ndim =  2 
shape =  (512, 512) 
max =  4886
</pre>


<figure>
<p><img src="f2.png" class="img-responsive" alt="f2.png">
</p>
</figure>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> scikit-image</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-jupyter-python"><span style="color: #ffad29; font-weight: bold;">from</span> skimage <span style="color: #ffad29; font-weight: bold;">import</span> io
<span style="color: #dbdb95;">im</span> = io.imread(<span style="color: #e67128;">"/home/dati/liaisan/data/160304/HEK293_ClopHensor-pBJ1_MatraS_attempt/10x_200_200_200/c1.tif"</span>)
<span style="color: #23d7d7;">print</span>(<span style="color: #e67128;">"ndim = "</span>, im.ndim, <span style="color: #e67128;">"\nshape = "</span>, im.shape, <span style="color: #e67128;">'\nmax = '</span>, im.<span style="color: #23d7d7;">max</span>())
plt.imshow(im[0,:,:,0])
</pre>
</div>

<pre class="example">
ndim =  4 
shape =  (5, 512, 512, 3) 
max =  4886
</pre>


<figure>
<p><img src="f3.png" class="img-responsive" alt="f3.png">
</p>
</figure>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Other two options</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> tifffile</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre class="src src-jupyter-python"><span style="color: #ffad29; font-weight: bold;">import</span> tifffile
<span style="color: #dbdb95;">im</span> = tifffile.imread(<span style="color: #e67128;">"/home/dati/liaisan/data/160304/HEK293_ClopHensor-pBJ1_MatraS_attempt/10x_200_200_200/c1.tif"</span>)
<span style="color: #23d7d7;">print</span>(<span style="color: #e67128;">"ndim = "</span>, im.ndim, <span style="color: #e67128;">"\nshape = "</span>, im.shape, <span style="color: #e67128;">'\nmax = '</span>, im.<span style="color: #23d7d7;">max</span>())
tifffile.imshow(im)
</pre>
</div>

<pre class="example">
ndim =  4 
shape =  (5, 3, 512, 512) 
max =  4886
</pre>


<figure>
<p><img src="f4.png" class="img-responsive" alt="f4.png">
</p>
</figure>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Tiles</h4>
<div class="outline-text-4" id="text-3-1-1">
<div class="org-src-container">

<pre class="src src-jupyter-python"><span style="color: #dbdb95;">im</span> = tifffile.imread(<span style="color: #e67128;">"/home/dati/marta/efrem/20160620/efrem/gap20/t2_1.tif"</span>)
im[0].TiffPage()
</pre>
</div>

<pre class="example">
---------------------------------------------------------------------------
FileNotFoundError                         Traceback (most recent call last)
Cell In [94], line 1
----&gt; 1 im = tifffile.imread("/home/dati/marta/efrem/20160620/efrem/gap20/t2_1.tif")
      2 im[0].TiffPage()

File ~/.pyenv/versions/3.11.0/envs/py311/lib/python3.11/site-packages/tifffile/tifffile.py:1008, in imread(files, aszarr, key, series, level, squeeze, maxworkers, mode, name, offset, size, pattern, axesorder, categories, imread, sort, container, axestiled, ioworkers, chunkmode, fillvalue, zattrs, multiscales, omexml, out, _multifile, _useframes, **kwargs)
   1003     files = files[0]
   1005 if isinstance(files, str) or not isinstance(
   1006     files, collections.abc.Sequence
   1007 ):
-&gt; 1008     with TiffFile(
   1009         files,
   1010         mode=mode,
   1011         name=name,
   1012         offset=offset,
   1013         size=size,
   1014         omexml=omexml,
   1015         _multifile=_multifile,
   1016         _useframes=_useframes,
   1017         **is_flags,
   1018     ) as tif:
   1019         if aszarr:
   1020             assert key is None or isinstance(key, int)

File ~/.pyenv/versions/3.11.0/envs/py311/lib/python3.11/site-packages/tifffile/tifffile.py:3832, in TiffFile.__init__(self, file, mode, name, offset, size, omexml, _multifile, _useframes, _parent, **is_flags)
   3829 if mode not in (None, 'r', 'r+', 'rb', 'r+b'):
   3830     raise ValueError(f'invalid mode {mode!r}')
-&gt; 3832 fh = FileHandle(file, mode=mode, name=name, offset=offset, size=size)
   3833 self._fh = fh
   3834 self._multifile = True if _multifile is None else bool(_multifile)

File ~/.pyenv/versions/3.11.0/envs/py311/lib/python3.11/site-packages/tifffile/tifffile.py:13088, in FileHandle.__init__(self, file, mode, name, offset, size)
  13086 self._close = True
  13087 self._lock = NullContext()
&gt; 13088 self.open()
  13089 assert self._fh is not None

File ~/.pyenv/versions/3.11.0/envs/py311/lib/python3.11/site-packages/tifffile/tifffile.py:13103, in FileHandle.open(self)
  13101 self._file = os.path.realpath(self._file)
  13102 self._dir, self._name = os.path.split(self._file)
&gt; 13103 self._fh = open(self._file, self._mode)  # type: ignore
  13104 self._close = True
  13105 if self._offset &lt; 0:

FileNotFoundError: [Errno 2] No such file or directory: '/home/dati/marta/efrem/20160620/efrem/gap20/t2_1.tif'
</pre>

<div class="org-src-container">

<pre class="src src-ipython">  with tifffile.TiffFile('/home/dati/marta/efrem/20160620/efrem/gap20/t2_1.tif') as tif:
    print(tif)
    images = tif.asarray()
    for page in tif:
      print(page.axes)
      # tifffile.tifffile.TiffPage(page)
      for tag in page.tags.values():
        t = tag.name, tag.value
      image = page.asarray()
  print(image)
</pre>
</div>

<pre class="example">
TIFF file: SHA256E-s43989163--ea6be4f70a5276fb918715b492ad544da90a1a917cf8931e44306d60f070eaa2.tif, 42 MiB, little endian, 81 pages
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX

YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
YX
[[1390 1401 1508 ..., 1109 1267 1087]
 [1565 1718 1910 ..., 1793 1618 1753]
 [1790 1808 2019 ..., 1950 1968 1892]
 ..., 
 [1626 1740 1773 ..., 1831 1776 1848]
 [1644 1805 1743 ..., 1701 1884 1711]
 [1587 1655 1831 ..., 1786 1968 1886]]
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> bioformat</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-jupyter-python"><span style="color: #ffad29; font-weight: bold;">import</span> javabridge
<span style="color: #ffad29; font-weight: bold;">import</span> bioformats
javabridge.start_vm(class_path=bioformats.JARS)
path = <span style="color: #e67128;">"/home/dati/GBM_persson/data/15.02.05_cal-GBM5-pBJclop/ph633/1_20_40.tif"</span>
imagedata = bioformats.ImageReader(path)
image_desc = bioformats.get_omexml_metadata(path)
image_desc = bioformats.OMEXML(image_desc)
num_images = image_desc.get_image_count()

javabridge.kill_vm()
</pre>
</div>

<pre class="example">
---------------------------------------------------------------------------
ModuleNotFoundError                       Traceback (most recent call last)
Cell In [95], line 1
----&gt; 1 import javabridge
      2 import bioformats
      3 javabridge.start_vm(class_path=bioformats.JARS)

ModuleNotFoundError: No module named 'javabridge'
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Conclusions</h2>
<div class="outline-text-2" id="text-4">
<p>
Scikit-image is the winner (over scipy.ndimage and matplotlib.image) when importing microscopy data tiff stacks (multiplanes, multichannels, multitime points).
</p>

<p>
skimage conventions are <a href="http://scikit-image.org/docs/dev/user_guide/numpy_images.html#coordinate-conventions">here</a>.
</p>
</div>
</div>
</div></div></div>
<footer id="postamble" class="">
<div><p class="author">Author: Daniele Arosio - This post was written entirely in org-mode and ob-ipython. You can download this notebook.</p>
<p class="date">Created: 2022-11-11 Fri 06:23</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 28.2 (<a href="http://orgmode.org">Org-mode</a> 9.5.5)</p>
</div>
</footer>
</body>
</html>